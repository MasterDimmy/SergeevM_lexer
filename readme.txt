ЗАПУСК И ИСПОЛЬЗОВАНИЕ:

Запуск: ./lexer.py svch.html svch.txt 
На выходе будет создан: svch.html.new.html с заменами p на тэги h1 и h2 по правилам:

[RULE1] Тут должны быть помечены заголовки "2." и "2.3" так как перед ними стоит заголовок меньшего уровня.
[RULE2] И помечены заголовки "1." "1.2" "2." "2.2", так как они имеют дочерние заголовки.

2) Дальше помечаем главы h1 и h2 в html.
[RULE3] 1. Первый найденный заголовок помечаем h1 и переходим к следующему.
2. В цикле делаем проверки для очередного найденного заголовка:
[RULE4] - Если заголовок помечен как ГЛАВНЫЙ и он находится на той же странице, что и предыдущий h1, то помечаем его как h2
[RULE5] - Если заголовок помечен как ГЛАВНЫЙ и на странице нет других h1, то помечаем его h1
[RULE6] - Если заголовок не помечен как ГЛАВНЫЙ и до предыдущего h1 меньше 3 страниц, то помечаем его как h2
[RULE7] - Если заголовок не помечен как ГЛАВНЫЙ и до предыдущего h1 больше или равно 3 страниц, то помечаем его как h1

[RULE8]  Нужно выделять заголовки в соответствии с BookmarkPageNumber


Для проверки результата использую
fc svch.html svch.html.new.html > diff.html

Получаем

***** svch.html
<P class="p12 ft9">3</P>
<P class="p24 ft17">ВВЕДЕНИЕ</P>
<P class="p25 ft10">Диапазон сверхвысоких частот располагается между радиоди
***** SVCH.HTML.NEW.HTML
<P class="p12 ft9">3</P>
<h1 class="p24 ft17">ВВЕДЕНИЕ</h1>
<P class="p25 ft10">Диапазон сверхвысоких частот располагается между радиоди
*****

***** svch.html
<P class="p28 ft17">1. ВОЛНЫ В ЛИНИЯХ ПЕРЕДАЧИ СВЧ</P>
<P class="p29 ft17">1.1. Типы линий передачи</P>
<P class="p30 ft7">Линия передачи СВЧ есть устройство, ограничивающее област?
***** SVCH.HTML.NEW.HTML
<P class="p28 ft17">1. ВОЛНЫ В ЛИНИЯХ ПЕРЕДАЧИ СВЧ</P>
<h2 class="p29 ft17">1.1. Типы линий передачи</h2>
<P class="p30 ft7">Линия передачи СВЧ есть устройство, ограничивающее област?
*****


Сложные случаи

***** canon.html
        <TD class="tr2 td7"><P class="p80 ft2"><A href="#page_9">1.</A></P></TD>
        <TD class="tr2 td8"><P class="p81 ft2"><A href="#page_9">Important Safety Instructions.................................
.</A></P></TD>
        <TD class="tr2 td7"><P class="p82 ft2"><A href="#page_9">5</A></P></TD>
***** CANON.HTML.NEW.HTML
        <TD class="tr2 td7"><P class="p80 ft2"><A href="#page_9">1.</A></P></TD>
        <TD class="tr2 td8"><h1 class="p81 ft2"><A href="#page_9">Important Safety Instructions................................
..</A></h1></TD>
        <TD class="tr2 td7"><P class="p82 ft2"><A href="#page_9">5</A></P></TD>
*****


Так удобно проверить корректность алгоритма.

Скрипт работает с входными файлами UTF-8 без BOM. Если же требуется с BOM, 
то все строки вида f = open(A, B) следует заменить на f = codecs.open(A, B, "utf-8-sig")